# 3. 기능 (Functions)

> ※ 각 기능이 어떤 사용자를 위한 것이며, 어떤 SQL feature를 사용하는지 명시해주세요.

본 프로젝트의 기능은 CPU 온도 측정 및 랭킹, 권한 기반의 커뮤니티 상호작용을 중심으로 구성되며, **4단계 역할(Role) 체계**와 밀접하게 연동되어 있습니다.

> **개발 역할 분배**: 각 기능은 프론트엔드와 백엔드로 명확히 분리되어 있으며, 팀 멤버들이 프론트엔드와 백엔드 작업을 골고루 분배하여 개발했습니다. 각 기능의 프론트엔드/백엔드 역할은 아래 표에 명시되어 있습니다.

---

## 0. 인증 및 사용자 관리 기능

| **기능 분류**      | **대상 사용자** | **설명**                                                                                                                                       | **프론트엔드/백엔드 분배**                                                                       | **SQL Feature**                                                                                                   |
| :----------------- | :-------------- | :--------------------------------------------------------------------------------------------------------------------------------------------- | :----------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------- |
| **회원가입**       | 신규 사용자     | 닉네임, 비밀번호, 직군을 입력하여 계정을 생성합니다.<br>• 닉네임 중복 검사<br>• 비밀번호 해싱 (bcrypt)<br>• 기본 역할: Developer (role_id = 1) | **프론트엔드**: 회원가입 폼 UI, 유효성 검사<br>**백엔드**: 사용자 생성, 비밀번호 해싱, 중복 검사 | `INSERT`, `SELECT`, `UNIQUE CONSTRAINT` (닉네임 중복 방지), `FOREIGN KEY` (`dev_group_id`, `role_id` 참조 무결성) |
| **로그인**         | 전 사용자       | 닉네임과 비밀번호로 로그인합니다.<br>• 세션 관리 (HTTP-only Cookie)<br>• 비밀번호 검증 (bcrypt)                                                | **프론트엔드**: 로그인 폼 UI<br>**백엔드**: 인증 처리, 세션 생성                                 | `SELECT`, `WHERE`                                                                                                 |
| **로그아웃**       | 전 사용자       | 현재 세션을 종료합니다.                                                                                                                        | **프론트엔드**: 로그아웃 버튼 UI<br>**백엔드**: 세션 삭제                                        | -                                                                                                                 |
| **인증 상태 확인** | 전 사용자       | 현재 로그인한 사용자 정보를 조회합니다.<br>• Hot Developer 당일 여부 확인                                                                      | **프론트엔드**: 사용자 정보 표시<br>**백엔드**: 세션 검증, 사용자 정보 조회                      | `SELECT`, `JOIN`, `WHERE`, `DATE` 함수                                                                            |

---

## 1. CPU 온도 측정 및 랭킹 기능 (정량화 및 경쟁)

| **기능 분류**                    | **대상 사용자**                                           | **설명**                                                                                                                                                                                                                                                                                                | **프론트엔드/백엔드 분배**                                                                  | **SQL Feature**                                                                                                                                                            |
| :------------------------------- | :-------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **CPU 온도 측정**                | Developer, Optimizer, Root<br>(Hot Developer는 당일 제외) | 매일 직군별 질문에 답변을 등록하고, 가중치 기반으로 스트레스 지수(CPU 온도)를 계산하여 저장합니다.<br>• 공통 질문 4개 (50% 가중치)<br>• 직군별 질문 4개 (30% 가중치)<br>• Hot Developer 특별 질문 2개 (20% 가중치)<br>• 수면시간은 역방향 계산 (적을수록 높은 점수)<br>• 배지 자동 부여 (각 질문별 1등) | **프론트엔드**: 질문 입력 UI, 배지 표시<br>**백엔드**: 답변 저장, 점수 계산, 배지 부여 로직 | `INSERT`, `UPSERT` (중복 방지), `SELECT`, `AGGREGATE` (`MAX`, `MIN`), `WHERE`, `UNIQUE CONSTRAINT` (`user_id`, `question_id`, `answer_date` 중복 방지), `JOIN`, `ORDER BY` |
| **랭킹 조회 (오늘)**             | 전 사용자                                                 | 오늘 날짜의 CPU 온도 랭킹을 조회합니다.<br>• 전체 랭킹 / 직군별 랭킹 필터링<br>• TOP 20명 조회<br>• 사용자 정보, 배지, 공통 질문 답변 포함                                                                                                                                                              | **프론트엔드**: 랭킹 카드 UI, 필터링 UI<br>**백엔드**: 랭킹 데이터 조회, VIEW 활용          | `VIEW` (`today_ranking_view`), `SELECT`, `JOIN`, `ORDER BY`, `LIMIT`, `WHERE`, `DATE` 함수                                                                                 |
| **랭킹 조회 (누적)**             | 전 사용자                                                 | 모든 날짜의 평균 CPU 온도를 계산하여 누적 랭킹을 조회합니다.<br>• 사용자별 평균 점수 계산<br>• 공통 질문 답변의 평균값 포함                                                                                                                                                                             | **프론트엔드**: 누적 랭킹 카드 UI<br>**백엔드**: 평균 계산, VIEW 활용                       | `VIEW` (`total_ranking_view`), `SELECT`, `JOIN`, `GROUP BY`, `AGGREGATE` (`AVG`), `ORDER BY`, `LIMIT`                                                                      |
| **Hot Developer 선정**           | 시스템 (Cron Job)                                         | 매일 자정, 전날 직군별 CPU 온도 1위 유저를 선정하고 해당 유저의 역할을 변경합니다.<br>• 동점자 처리: 전날 CPU 온도를 가장 먼저 측정한 사용자 우선<br>• 기존 Hot Developer 역할 변경 (Developer 복귀 또는 Optimizer 승급)                                                                                | **프론트엔드**: Hot Developer 안내 UI<br>**백엔드**: 선정 로직, 역할 변경, 트랜잭션 처리    | `SELECT`, `INSERT`, `UPDATE`, `UPSERT`, `JOIN`, `ORDER BY`, `AGGREGATE` (`MAX`), `WHERE`, `DATE` 함수, `UNIQUE CONSTRAINT` (`dev_group_id`, `effective_date` 중복 방지)    |
| **칭호(배지) 부여**              | 전 사용자                                                 | 일일 CPU 온도 측정 시, 각 질문별 1등을 기록한 사용자에게 해당 질문의 배지를 자동 부여합니다.<br>• Hot Developer 질문(SPECIAL 카테고리)은 배지 부여 제외<br>• 배지는 하루만 유효 (다음 날 자정에 자동 삭제)<br>• 수면시간은 최소값 기준, 나머지는 최대값 기준                                            | **프론트엔드**: 배지 표시 컴포넌트<br>**백엔드**: 배지 부여 로직, 자동 삭제                 | `SELECT`, `INSERT`, `UPSERT`, `AGGREGATE` (`MAX`, `MIN`), `WHERE`, `UNIQUE CONSTRAINT` (`user_id`, `badge_id`, `granted_date` 중복 방지)                                   |
| **Hot Developer 특별 질문 작성** | Hot Developer (당일 선정자)                               | Hot Developer가 자신의 직군을 위한 특별 질문 2개를 작성합니다.<br>• 기존 특별 질문 비활성화 후 새 질문 생성<br>• 트랜잭션으로 원자성 보장<br>• 해당 직군의 다음 측정부터 적용                                                                                                                           | **프론트엔드**: 질문 작성 폼 UI<br>**백엔드**: 질문 생성, 트랜잭션 처리, 기존 질문 비활성화 | `TRANSACTION` (기존 질문 비활성화 + 새 질문 생성이 하나의 트랜잭션으로 묶여 원자성 보장), `UPDATE`, `INSERT`, `WHERE`                                                      |

---

## 2. 권한 기반 커뮤니티 기능 (소통 및 지식 공유)

| **기능 분류**      | **대상 사용자**                                 | **설명**                                                                                                                                                                                               | **프론트엔드/백엔드 분배**                                                                              | **SQL Feature**                                                                                                                                                                                                                                   |
| :----------------- | :---------------------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **고민 등록**      | Developer, Hot Developer, Root                  | 개발 고충을 고민 게시판에 등록합니다.<br>• Optimizer는 등록 불가                                                                                                                                       | **프론트엔드**: 고민 작성 폼 UI<br>**백엔드**: 고민 저장, 권한 검증                                     | `INSERT`, `DEFAULT`, `FOREIGN KEY` (`user_id`, `dev_group_id` 참조 무결성), `Authorization` (역할 기반 접근 제어)                                                                                                                                 |
| **고민 답변 작성** | Optimizer, Root                                 | 등록된 고민에 대해 조언과 답변을 작성합니다.<br>• Optimizer는 **같은 직군의 고민에만** 답변 가능<br>• Root는 모든 직군의 고민에 답변 가능<br>• 답변 작성 시 `users.total_answers` 자동 증가            | **프론트엔드**: 답변 작성 UI<br>**백엔드**: 답변 저장, 직군 검증, 통계 업데이트                         | `INSERT`, `DEFAULT`, `FOREIGN KEY`, `UPDATE`, `WHERE`, `Authorization` (역할 기반 접근 제어)                                                                                                                                                      |
| **답변 채택**      | 고민 등록자<br>(Developer, Hot Developer, Root) | 받은 답변 중 하나를 반드시 채택해야 합니다.<br>• 미채택 시 CPU 온도 측정 불가<br>• 한 고민당 하나의 답변만 채택 가능 (기존 채택 답변 자동 취소)<br>• 채택 시 `users.total_accepted` 증가, 취소 시 감소 | **프론트엔드**: 채택 버튼 UI<br>**백엔드**: 채택 로직, 트랜잭션 처리                                    | `TRANSACTION` (기존 답변 취소, 새 답변 채택, 고민 상태 업데이트, 사용자 통계 업데이트가 하나의 트랜잭션으로 묶여 데이터 무결성 보장), `UPDATE`, `WHERE`, `JOIN`                                                                                   |
| **밈 등록**        | Developer, Hot Developer, Root                  | 개발 관련 밈(Meme)을 게시판에 등록합니다.<br>• 하루 1회 제한<br>• 이미지 업로드 지원 (Supabase Storage)                                                                                                | **프론트엔드**: 밈 작성 폼, 이미지 업로드 UI<br>**백엔드**: 밈 저장, 이미지 업로드 처리, 일일 제한 검증 | `INSERT`, `DEFAULT`, `FOREIGN KEY`                                                                                                                                                                                                                |
| **밈 좋아요 투표** | 전 사용자 (역할별 차등)                         | 밈 게시물에 좋아요 투표를 합니다.<br>• Developer, Hot Developer, Optimizer: 하루 3개<br>• Root: 하루 6개<br>• 좋아요 취소 가능<br>• `meme_like` 테이블 기준으로 일일 집계                              | **프론트엔드**: 좋아요 버튼 UI<br>**백엔드**: 좋아요 처리, 트랜잭션 처리, 일일 제한 검증                | `TRANSACTION` (`meme_like` 생성/삭제, `meme.like_count` 업데이트, `user_daily_like` 업데이트가 하나의 트랜잭션으로 묶여 데이터 무결성 보장), `INSERT`, `DELETE`, `UPDATE`, `UNIQUE CONSTRAINT` (`meme_id`, `user_id` 중복 방지), `WHERE`, `COUNT` |

---

## 3. Root 특권 기능 (운영 및 정책 결정)

| **기능 분류**        | **대상 사용자** | **설명**                                                                                                                                                          | **프론트엔드/백엔드 분배**                                                              | **SQL Feature**                                                                                                                                      |
| :------------------- | :-------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------------------------------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------- |
| **가중치 로직 변경** | Root            | CPU 온도 계산에 사용되는 질문별 가중치를 조정합니다.<br>• 한 질문의 가중치 증가 시 다른 질문의 가중치 감소<br>• 총 가중치 합계 100% 유지<br>• 변경 이력 자동 기록 | **프론트엔드**: 가중치 조정 UI<br>**백엔드**: 가중치 업데이트, 트랜잭션 처리, 이력 로깅 | `TRANSACTION` (두 개의 `UPDATE` 쿼리가 동시에 커밋되어 전체 가중치의 합(100%) 무결성 유지), `INSERT` (`question_weight_log` 테이블에 변경 내역 기록) |

---

## 4. 역할 자동 변경 기능 (승급/강등)

| **기능 분류**      | **대상 사용자**   | **설명**                                                                                                                       | **프론트엔드/백엔드 분배**                  | **SQL Feature**                                                                         |
| :----------------- | :---------------- | :----------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------ | :-------------------------------------------------------------------------------------- |
| **Optimizer 승급** | 시스템 (Cron Job) | Hot Developer 누적 10회 **AND** 고유 칭호 5개 이상 획득 시 Optimizer로 승급합니다.                                             | **백엔드**: 승급 로직, 조건 검증, 역할 변경 | `SELECT`, `UPDATE`, `JOIN`, `WHERE`, `COUNT` (집계), `GROUP BY`를 활용한 복합 조건 집계 |
| **Root 승급**      | 시스템 (Cron Job) | Optimizer 역할 **AND** 답변 50회 이상 **AND** 채택률 80% 이상 시 Root로 승급합니다.                                            | **백엔드**: 승급 로직, 조건 검증, 역할 변경 | `SELECT`, `UPDATE`, `WHERE`, `AGGREGATE` (계산)                                         |
| **Optimizer 강등** | 시스템 (Cron Job) | Optimizer 역할 **AND** 답변 10회 이상 **AND** 미채택률 80% 이상 시 Developer로 강등합니다.<br>• 강등 시 `hot_dev_count` 초기화 | **백엔드**: 강등 로직, 조건 검증, 역할 변경 | `SELECT`, `UPDATE`, `WHERE`, `AGGREGATE` (계산)                                         |

---

## 5. 대시보드 요약 기능

| **기능 분류**     | **대상 사용자** | **설명**                                                                                                                  | **프론트엔드/백엔드 분배**                                                            | **SQL Feature**                                                                                                                                |
| :---------------- | :-------------- | :------------------------------------------------------------------------------------------------------------------------ | :------------------------------------------------------------------------------------ | :--------------------------------------------------------------------------------------------------------------------------------------------- |
| **대시보드 요약** | 전 사용자       | 오늘의 Hot CPU, Hot 직군, 인기 밈, 최신 고민을 한 번에 조회합니다.<br>• 실시간 데이터 집계<br>• VIEW 활용으로 성능 최적화 | **프론트엔드**: 대시보드 카드 UI, 데이터 시각화<br>**백엔드**: 데이터 집계, VIEW 활용 | `VIEW` (`today_hot_cpu_view`, `dev_group_today_avg_view`, `popular_memes_view`, `recent_concerns_view`), `SELECT`, `JOIN`, `ORDER BY`, `LIMIT` |

---

## 주요 SQL Feature 사용 현황 요약

### 데이터 조작 언어 (DML)

- **SELECT**: 모든 조회 기능
- **INSERT**: 회원가입, 밈/고민 등록, 답변 작성, 배지 부여
- **UPDATE**: 점수 업데이트, 좋아요 수 변경, 역할 변경, 답변 채택
- **DELETE**: 배지 삭제, 좋아요 취소
- **UPSERT**: 중복 방지 및 업데이트 (CPU 온도 측정, Hot Developer 선정, 배지 부여)

### 데이터 정의 언어 (DDL)

- **UNIQUE CONSTRAINT**: 닉네임 중복 방지, 일일 중복 답변 방지, 직군당 일일 Hot Developer 1명 제한
- **FOREIGN KEY**: 테이블 간 참조 무결성 보장
- **PRIMARY KEY**: 기본키 설정 (단일/복합)
- **INDEX**: 조회 성능 최적화
- **ENUM**: 질문 카테고리 타입 정의
- **DEFAULT**: 기본값 설정

### 뷰 (VIEW)

- **6개의 VIEW 생성**: 복잡한 조회 쿼리 최적화 및 재사용성 향상
- 랭킹, 대시보드, 밈, 고민 조회에 활용

### 트랜잭션 (TRANSACTION)

- **Hot Developer 특별 질문 작성**: 기존 질문 비활성화 + 새 질문 생성 (원자성 보장)
- **질문 가중치 조정**: 두 질문의 가중치 동시 변경 + 이력 로깅 (총합 100% 무결성)
- **답변 채택**: 기존 답변 취소 + 새 답변 채택 + 고민 상태 업데이트 + 사용자 통계 업데이트 (원자성 보장)
- **밈 좋아요**: `meme_like` 생성/삭제 + `meme.like_count` 업데이트 + `user_daily_like` 업데이트 (원자성 보장)

### 집계 함수 (AGGREGATE Functions)

- **MAX/MIN**: CPU 온도 최고값/최저값 계산
- **AVG**: 누적 랭킹 평균 점수 계산
- **COUNT**: 답변 수, 좋아요 수 집계

### 권한 기반 접근 제어 (Authorization)

- **애플리케이션 레벨 검증**: 모든 API에서 `users.role.name` 기반 권한 검증
- **조건부 접근**: 역할별로 다른 제약사항 적용

---

## 데이터 무결성 보장

1. **UNIQUE 제약**: 중복 데이터 방지
2. **FOREIGN KEY 제약**: 참조 무결성 보장
3. **트랜잭션**: 가중치 변경, Hot Developer 질문 작성, 답변 채택, 밈 좋아요 시 원자성 보장
4. **애플리케이션 레벨 검증**: 역할별 권한, 제약사항 엄격히 검증

---

## 개발 역할 분배

본 프로젝트는 각 기능을 프론트엔드와 백엔드로 명확히 분리하여 개발했습니다. 팀 멤버들은 프론트엔드와 백엔드 작업을 골고루 분배하여 개발했습니다.

**여채언**:

- 인증 기능 (로그인, 회원가입) 프론트엔드 및 백엔드
- CPU 온도 측정 기능 프론트엔드
- 랭킹 조회 기능 백엔드 (VIEW 활용)
- 고민 게시판 프론트엔드
- 밈 게시판 백엔드
- 대시보드 요약 기능 프론트엔드
- Hot Developer 특별 질문 작성 기능 백엔드

**김태란**:

- 인증 기능 (로그인, 회원가입) 백엔드
- CPU 온도 측정 기능 백엔드 (점수 계산, 배지 부여)
- 랭킹 조회 기능 프론트엔드
- 고민 게시판 백엔드 (답변 작성, 채택 로직)
- 밈 게시판 프론트엔드
- 대시보드 요약 기능 백엔드 (VIEW 활용)
- Hot Developer 선정 및 역할 승급/강등 로직 백엔드
- Hot Developer 특별 질문 작성 기능 프론트엔드

각 기능의 프론트엔드와 백엔드 작업은 서로 다른 멤버가 담당하여 프론트엔드와 백엔드 경험을 골고루 쌓을 수 있도록 했으며, 한 멤버가 특정 기능의 프론트엔드를 담당했다면 다른 기능에서는 백엔드를 담당하는 방식으로 역할을 교차 배치했습니다. 이를 통해 모든 멤버가 Next.js 프론트엔드, Prisma ORM, Supabase 백엔드 기술을 경험할 수 있었고, 각 기능의 프론트엔드와 백엔드가 명확히 분리되어 유지보수성과 확장성이 향상되었습니다.
